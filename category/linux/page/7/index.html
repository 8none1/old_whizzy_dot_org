<!DOCTYPE html>
<html lang="en-GB">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="/xmlrpc.php">
	<title>linux &#8211; Page 7 &#8211; whizzy.org</title>
<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//s.w.org">
<link rel="alternate" type="application/rss+xml" title="whizzy.org &raquo; Feed" href="/feed/">
<link rel="alternate" type="application/rss+xml" title="whizzy.org &raquo; Comments Feed" href="/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="whizzy.org &raquo; linux Category Feed" href="/category/linux/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}</style>
	<link rel="stylesheet" id="wp-block-library-css" href="/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="googleOpenSans-css" href="//fonts.googleapis.com/css?family=Open+Sans%3A400%2C400italic%2C600%2C700%2C700italic&#038;subset=latin%2Ccyrillic&#038;ver=5.7.2" type="text/css" media="all">
<link rel="stylesheet" id="bootstrap-css" href="/wp-content/themes/emmet-lite/css/bootstrap.min.css" type="text/css" media="all">
<link rel="stylesheet" id="font-awesome-css" href="/wp-content/themes/emmet-lite/css/font-awesome.min.css" type="text/css" media="all">
<link rel="stylesheet" id="flexslider-css" href="/wp-content/themes/emmet-lite/css/flexslider.min.css" type="text/css" media="all">
<link rel="stylesheet" id="emmet-main-css" href="/wp-content/themes/emmet-lite/css/emmet-style.min.css" type="text/css" media="all">
<link rel="stylesheet" id="emmet-style-css" href="/wp-content/themes/emmet-lite/style.css" type="text/css" media="all">
<script type="text/javascript" src="/wp-includes/js/jquery/jquery.min.js" td="jquery-core-js"></script>
<script type="text/javascript" src="/wp-includes/js/jquery/jquery-migrate.min.js" td="jquery-migrate-js"></script>
<link rel="https://api.w.org/" href="/wp-json/">
<link rel="alternate" type="application/json" href="/wp-json/wp/v2/categories/8">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.7.2">
    <style type="text/css" id="theme-header-css">.welcome-right {
            background: url("/wp-content/themes/emmet-lite/images/welcome-image.png") no-repeat scroll left center rgba(0, 0, 0, 0);
        }

                        .third-left {
            background: url("/wp-content/themes/emmet-lite/images/third-image.png") no-repeat scroll right center rgba(0, 0, 0, 0);
        }</style>
    <style type="text/css" id="custom-background-css">body.custom-background { background-image: url("/wp-content/themes/emmet-lite/images/main-bg.jpg"); background-position: center top; background-size: auto; background-repeat: no-repeat; background-attachment: fixed; }</style>
	</head>
<body class="archive paged category category-linux category-8 custom-background paged-7 category-paged-7 emmet pages-background">
<a class="skip-link screen-reader-text" href="#main">
	Skip to content</a>
<div class="wrapper  ">
				<header id="header" class="main-header">
							<div class="top-header">
					<div class="container">
												<div class="top-menu">
							<ul id="menu-top-menu" class="menu"></ul>							<div class="clearfix"></div>
						</div>

						<div class="social-profile type1 ">
																						<a href="https://twitter.com/8none1" class="button-twitter" title="Twitter" target="_blank"><i class="fa fa-twitter-square"></i></a>
																													<a href="https://github.com/8none1" class="button-google" title="Google +" target="_blank"><i class="fa fa-google-plus-square"></i></a>
																																											<a href="https://www.youtube.com/user/willcooke1" class="button-youtube" title="Youtube" target="_blank"><i class="fa fa-youtube-square"></i></a>
																					                            						</div>
						<div class="contact-info ">
							<ul class=" info-list">
																																																									</ul>
							<div class="clearfix"></div>
						</div>
					</div>
				</div>
							<div class="site-header" data-sticky-menu="off">
				<div class="container">
					<div class="site-logo">
													<a class="home-link" href="/" title="whizzy.org" rel="home">
                                											<div class="site-description">
									<p class="site-title ">whizzy.org</p>
																			<p class="site-tagline">On code and gadgets.</p>
																	</div>
							</a>
											</div>
                    <button class="menu-toggle" aria-controls="main-menu" aria-expanded="false"><span class="menu-show">Menu</span>
                        <span class="menu-close">Close</span>
                        
                    </button>
					<div id="navbar" class="navbar">
						<nav id="site-navigation" class="main-navigation">
							<ul class="sf-menu"></ul>						</nav>
					</div>
					<div class="clearfix"></div>
				</div>
			</div>
		</header>
		<div id="main" class="site-main">
    <div class="container breadcrumb-wrapper">
        <div class="breadcrumb breadcrumbs sp-breadcrumbs"><div class="breadcrumb-trail">
<a href="/" title="whizzy.org" rel="home" class="trail-begin">Home</a> <span class="sep"><i class="fa fa-angle-right"></i></span> <span class="trail-end">linux</span>
</div></div>    </div>
<div class="container main-container">
    <div class="row clearfix">
        <div class=" col-xs-12 col-sm-12 col-md-8 col-lg-8">
                         
                                                    <article id="post-291" class="post-in-blog post post-291 type-post status-publish format-standard hentry category-linux category-making-the-world-a-better-place category-tv">
                    <header class="entry-header">
        <h2 class="entry-title">
            <a href="/2010/08/04/hauppauge-wintv-nova-s-plus-on-linux/" rel="bookmark">Hauppauge WinTV Nova-S Plus on Linux</a>
        </h2>
    </header> 
    <section class="entry entry-content">
        <p>The Nova-S Plus is a  good card.  <a href="http://www.hauppauge.co.uk/site/products/data_novasplus.html">http://www.hauppauge.co.uk/site/products/data_novasplus.html</a></p>
<p>But, it would appear there is a defect in these boards, or at least a strange design, which means that they won&#8217;t lock on to some frequencies which require the 22kHz tone sending to the LNB with new drivers because there&#8217;s no link between the flange and dolphin-points.  There&#8217;s plenty to read about here:</p>
<p><a href="https://bugzilla.kernel.org/show_bug.cgi?id=9476">https://bugzilla.kernel.org/show_bug.cgi?id=9476</a></p>
<p>And there&#8217;s a patch which fixes the problem by controlling the tone generator directly but it&#8217;ll never get in to the main kernel.  For your convenience here is a link to a binary driver built for Ubuntu Lucid kernel version 2.6.32-23-generic:</p>
<p><a href="/wp-content/uploads/2010/08/isl6421.ko">/wp-content/uploads/2010/08/isl6421.ko</a></p>
<p>Replace the current isl6421.ko from /lib/modules/2.6.32-23-generic/kernel/drivers/media/dvb/frontends/isl6421.ko with this one.  It might also work for newer kernel versions, or not.  Who knows?  Not me.</p>
<p>I&#8217;ve also got a Hauppauge S2 HD and this patched driver doesn&#8217;t seem to effect it.</p>
<p>Search hints:</p>
<p>Hauppauge Nova S plus linux won&#8217;t lock horizontal 22khz tone can&#8217;t pick up some channels. You can also check out my guide on <a style="text-decoration: none" href="http://outdoormoviehq.com/ultimate-guide-to-outdoor-movies/"><font color="#555555">Everything You Need to Set Up a Backyard Cinema</font></a>.</p>
        <div class="clearfix"></div>
          
       
    </section>
            <footer class="entry-footer">
                    <div class="meta">
					<span class="author">Posted by </span><a href="/author/will/" title="Posts by will" rel="author">will</a>                <span class="seporator">/</span>
                <span class="date-post h6">August 4, 2010</span>
                                                                                                                                                                                            <span class="seporator">/</span>
                        <span>Posted in</span>
                        <a href="/category/linux/" rel="category tag">linux</a><span>,</span> <a href="/category/making-the-world-a-better-place/" rel="category tag">Making the world a better place</a><span>,</span> <a href="/category/tv/" rel="category tag">tv</a>                                                                </div>
            </footer>
    </article><!-- #post -->                                    <article id="post-209" class="post-in-blog post post-209 type-post status-publish format-standard hentry category-asterisk category-linux category-tv">
                    <header class="entry-header">
        <h2 class="entry-title">
            <a href="/2009/09/16/asterisk-set-up-in-the-uk-with-sms/" rel="bookmark">Asterisk set up in the UK with SMS</a>
        </h2>
    </header> 
    <section class="entry entry-content">
        <p><strong>EDIT: 25 Sept 2010<br>
The below specifically refers to Asterisk 1.4. Go to the bottom for an update on 1.6</strong></p>
<p>Why do I always get myself in to these situations?</p>
<p>Many years ago I knocked up a set of scripts to record TV programs from a DVB-T card.  Getting the TV card working was really hard work.  I had to hack about with the driver source code, compile custom kernels, build endless versions of the driver, and so on and so on and so on.  It was a pain in the arse, which was compounded by the fact that at the time very few other people (end users) were trying to get these cards working, so there wasn&#8217;t much community support.  My scripts were great and everything and I could record TV, taxes were low and life was, on the whole, pretty good.</p>
<p>Then <a href="http://www.kryogenix.org/">Stuart</a> put me on to MythTV.  It quickly became evident that although my scripts were functional they were nothing compared to Myth.  So I moved over.  Again with the pain.</p>
<p>The basics were there but DVB support was in it&#8217;s infancy and it was a lot of hard work getting it working.  I persevered and learnt a lot about MythTV in the process.  Yay me.  At the beginning MythTV was a foreign country.  By the time I&#8217;d got it working the way I wanted it was my home town.</p>
<p>And so it will be with Asterisk, I hope.</p>
<p><span style="text-decoration: underline;">Things I have learnt about Asterisk</span></p>
<ol>
<li>The cheap FXO cards they sell on eBay are more trouble than they are worth.</li>
<li>The documentation on the <a href="http://www.voip-info.org/wiki/">voip-info site</a> is often out of date.</li>
<li>UK Caller ID works with the TDM400&#8217;s out of the box.</li>
<li>Sending &amp; receiving SMS&#8217;s does work, but it&#8217;s a bitch, and unreliable.</li>
<li>The logic in Asterisks&#8217; dial plan (extensions.conf et al) is illogical to me</li>
<li>FreePBX is both a blessing and a curse.</li>
<li>I love it.</li>
</ol>
<p>In a bit more detail then:</p>
<p>1.  The FXO cards you can get from eBay for about 20 quid work perfectly well.  For making calls.  But, there are a few drawbacks.  They don&#8217;t support polarity reversal which is the method by which incoming calls and Caller ID are announced to Asterisk.  You&#8217;ll still get ringing indications and be able to make calls, but you won&#8217;t get Caller ID.  Or rather, you can get Caller ID but you need to patch the Zaptel drivers and the Asterisk source.  The patches are old and don&#8217;t apply perfectly.  They are also seemingly unsupported now, in that no one cares if you are having problems with them.  I got the patches applied but Asterisk wouldn&#8217;t compile and I don&#8217;t know/care enough to fix it.  I was in the market for an ATA anyway so I put that 40 quid towards the cost of the TDM400p11 from <a href="http://www.novavox.co.uk/products/analogue-cards/a400p.html">NovaVox</a> and if I hadn&#8217;t bought the <a href="http://www.x100p.eu/product_info.php?products_id=39">AX-100</a> then the initial outlay for a fully supported card isn&#8217;t so bad.  It also works out cheaper to add another FXS port the to TDM400 than it does to buy another ATA.  The AX-100 also has a US spec. &#8220;<a href="http://en.wikipedia.org/wiki/Telephone_hybrid">hybrid</a>&#8221; in it which means that the <a href="http://en.wikipedia.org/wiki/Balun">unbalanced</a> UK spec phone lines and the AX-100 are not perfectly matched which can cause wicked echo.  The TDM400 has a tunable hybrid, and that&#8217;s a good thing.  All that said &#8211; for 20quid I still think it&#8217;s worth getting one to play with.  Ask me about doing a swap, if you&#8217;ve got any cool toys you don&#8217;t want  (I&#8217;ve got a DVB-T card going spare as well!).</p>
<p>2.  The <a href="http://www.voip-info.org/">VOIP-info.org</a> site is a really good source of data.  The website might be ugly, but there is a lot of Asterisk data on there.  Unfortunately there is little in the way of information, and some of the data is way out of date.  It acts as a good reference point but isn&#8217;t for the beginner because most pages assume a lot of prior knowledge.  Sure &#8211; I could go in and edit the Wiki, but I don&#8217;t know if what I&#8217;m doing is the best way of doing it, or even the correct way to do it.  So for now that&#8217;s what this blog post is for.</p>
<p>3.  BT send the Caller ID information before the first ring.  The process goes something like this:</p>
<pre class="codestyle"><em>Line polarity reversed -&gt; Caller ID sent as FSK (sort of modem tones) -&gt; Phone starts to ring -&gt; Call Connected -&gt; <a href="http://www.urbandictionary.com/define.php?term=Charlie+Brown+Teacher">Charlie Brown's Teacher</a> -&gt; Call Hung Up -&gt; Line polarity reversed</em>
</pre>
<p>You can see the importance of being able to detect polarity reversal in the call set-up and tear-down.  The AX100 simply doesn&#8217;t do it.  The TDM400 does, and it&#8217;s fully supported out of the box, as is UK style Caller ID, where the ID is sent before the first ring.  The hack for the AX100 keeps a buffer running all the time and then once a call comes in it looks in this buffer for the caller ID FSK and decodes it.  Shonky, I think you&#8217;ll agree.  My advice is that if you want to do caller ID in the UK buy a TDM400.  If you are a masochist then feel free to try with the AX100, I&#8217;d love to read your HowTo once you&#8217;ve got it working.</p>
<p>4.  SMS.  What a bitch.  I recently discovered my <a href="http://www.productsandservices.bt.com/consumerProducts/displayTopic.do?topicId=25504">subscription with BT</a> gives me 200 free SMS text messages a month.  So to make sure I was getting best value from the phone subscription I went out and spent 100quid on a PCI card and then spent hours and hours and hours fiddling about trying to get it working.  I don&#8217;t know why, I probably send about 3 text&#8217;s a month from my mobile, the whole <a href="http://en.wikipedia.org/wiki/George_Mallory">&#8220;Because it&#8217;s there&#8221;</a> thing I guess.  A pox on you, Mallory.</p>
<p>Last night I finally got it working semi-reliably for incoming and outgoing texts.  I can send and receive from my mobile, but Stuart doesn&#8217;t receive my messages.  Ho hum.</p>
<p><span style="text-decoration: underline;"><strong>Firstly, receiving SMS&#8217;s. </strong></span> Now, I don&#8217;t really understand the extensions.conf language.  It&#8217;s all a bit, well, wrong, to my eyes.  All I can tell you is that this is how I got it working.  <strong>NOTE:  This WILL NOT work for you if you just copy and paste.</strong> Sorry about that.  Perhaps someone can help me re-write it so that it does?</p>
<p>I&#8217;m using <a href="http://www.freepbx.org/">FreePBX</a> as a GUI and it rewrites some of the Asterisk config files for you.  I&#8217;m not sure if the context [from-pstn] is one that I created, or a standard one.  What you need to find out is what route incoming calls from the PSTN take i.e. which contexts they pass through before they start ringing on your internal phones.  You can do this my running the Asterisk console and turning verbosity up to about 6 (core set verbose 6) and then calling in from outside.  You should see a trace of what contexts get called as the call comes in.</p>
<p>For example, my call flow goes something like this:</p>
<pre class="codestyle">[from-zaptel] -&gt; [from-pstn] -&gt; [macro-user-callerid] -&gt; 600@[ext-group]
</pre>
<p>Where 600 is an extensions number I set up with FreePBX to ring all internal phones.</p>
<p>I chose to test for SMS&#8217;s in the [from-pstn] context. You can visualise what the [from-pstn] context does when a call comes in by using the Asterisk CLI.  Use the command &#8220;dialplan show s@from-pstn&#8221; to see the instructions that would be followed when [from-pstn] gets called at position &#8220;s&#8221;, or start.</p>
<p>Originally, mine went something like this:</p>
<pre class="codestyle">[ Included context 'ext-did-0001' created by 'pbx_config' ]
's' =&gt;            1. Set(__FROM_DID=${EXTEN})                   [pbx_config]
2. Gosub(cidlookup|cidlookup_1|1)             [pbx_config]
3. ExecIf($[ "${CALLERID(name)}" = "" ] |Set|CALLERID(name)=${CALLERID(num)}) [pbx_config]
4. Set(__CALLINGPRES_SV=${CALLINGPRES_${CALLINGPRES}}) [pbx_config]
5. SetCallerPres(allowed_not_screened)        [pbx_config]
6. Goto(ext-group|600|1)                      [pbx_config]
</pre>
<p>You can follow the call progression through this quite easily.  We jump in at position (or priority) 1, we set a variable, then we jump to some cidlookup sub-routine, then if the CALLERID(name) is blank we set it to be the same as the caller id number, then something about CALLINGPRES, not sure what that does, ditto the next line, and then we go to ext-group|600|1.  Ahhaaa!  I know that 600 is the group that I call to ring all the phones, so that must be where the call is handed off to other contexts or functions that let you do talking to people.  Since an incoming SMS doesn&#8217;t need to get as far as ringing on a phone, it makes sense to me to interrupt the call flow during [from-pstn].</p>
<p>So I added [from-pstn-custom] to /etc/asterisk/extensions_custom.conf like this:</p>
<pre class="codestyle">[from-pstn-custom]
exten =&gt; s,3,GotoIf($["${CALLERID(num)}" = "08005875290"]?will-sms,s,1)
exten =&gt; s,4,Verbose("Not an incoming SMS")
exten =&gt; s,5,Gosub(cidlookup,cidlookup_1,1)
exten =&gt; s,n,ExecIf($[ "${CALLERID(name)}" = "" ] ,Set,CALLERID(name)=${CALLERID(num)})
exten =&gt; s,n,Set(__CALLINGPRES_SV=${CALLINGPRES_${CALLINGPRES}})
exten =&gt; s,n,SetCallerPres(allowed_not_screened)
exten =&gt; s,n,Goto(ext-group,600,1)

[will-sms]
exten =&gt; s,1,Verbose(=============Entered Will SMS)
exten =&gt; s,n,Answer()
exten =&gt; s,n,Wait(2)
exten =&gt; s,n,SMS(default|a)
exten =&gt; s,n,Verbose(=============Done with Will SMS)
exten =&gt; s,n,Hangup(16)
</pre>
<p>How does it work?  The [from-pstn-custom] overrides the [from-pstn] from the main extensions.conf file provided by FreePBX and adds a line that branches to a context called [will-sms] which then uses the SMS application to receive the SMS and then hangup the phone.  (Actually, I think SMS hangs up for you.  But, you know, whatever)</p>
<p>In [from-pstn] in extensions.conf is a line that &#8220;includes&#8221; the config from &#8220;from-pstn-custom&#8221;.  By virtue of being imported, the instructions in [from-pstn-custom] take precedence over the other config, <span style="text-decoration: underline;">because it is imported first</span>.  The config files are read line by line in the order they appear in the file.  But, the imported instructions do not completely replace the config that is already there.  They are sort of merged. That&#8217;s why I&#8217;ve copied a load of bits from the original call flow in to my new [from-pstn-custom].  If I left them out, then some bits of my new context would be applied and some wouldn&#8217;t.  The way I got it to work was to replicate the call flow to the point of it branching off to [ext-group] in my new context.  If you do a &#8220;dialplan show s@from-pstn&#8221; now, you see this:</p>
<pre class="codestyle">[ Included context 'from-pstn-custom' created by 'pbx_config' ]
's' =&gt;            3. GotoIf($["${CALLERID(num)}" = "08005875290"]?will-sms|s|1) [pbx_config]
4. Verbose("Not an incoming SMS")             [pbx_config]
6. Gosub(cidlookup|cidlookup_1|1)             [pbx_config]
7. ExecIf($[ "${CALLERID(name)}" = "" ] |Set|CALLERID(name)=${CALLERID(num)}) [pbx_config]
[pbx_config]
9. Set(__CALLINGPRES_SV=${CALLINGPRES_${CALLINGPRES}}) [pbx_config]
10. SetCallerPres(allowed_not_screened)       [pbx_config]
11. Goto(ext-group|600|1)                     [pbx_config]

[ Included context 'ext-did-0001' created by 'pbx_config' ]
's' =&gt;            1. Set(__FROM_DID=${EXTEN})                   [pbx_config]
2. Gosub(cidlookup|cidlookup_1|1)             [pbx_config]
3. ExecIf($[ "${CALLERID(name)}" = "" ] |Set|CALLERID(name)=${CALLERID(num)}) [pbx_config]
4. Set(__CALLINGPRES_SV=${CALLINGPRES_${CALLINGPRES}}) [pbx_config]
5. SetCallerPres(allowed_not_screened)        [pbx_config]
6. Goto(ext-group|600|1)                      [pbx_config]

[ Included context 'ext-did-catchall' created by 'pbx_config' ]
'_.' =&gt;           1. Noop(Catch-All DID Match - Found ${EXTEN} - You probably want a DID for this.) [pbx_config]
2. Goto(ext-did|s|1)                          [pbx_config]
</pre>
<p>You can see my new [from-pstn-custom] context at the start, along with the copied commands from ext-did-001 to ensure that they run in the way I expected.  The upshot of this is that I now branch to my new context [will-sms] when the incoming caller ID is the BT 0800 number from where SMS&#8217;s originate.  You should note that the 0800 number can change if you have more than one incoming SMS box registered, so don&#8217;t do that.  Just register one incoming address  (more on this later).</p>
<p>The [will-sms] is pretty straight forward.  Answer the phone, wait 2 seconds, and then start the SMS application which does all the clever noises.  The key here is Wait.  Without it SMS reception is intermittent at best.  The SMS(default|a) tells the SMS app to receive in to the default queue (this works, don&#8217;t understand fully why) and to do an &#8220;a&#8221; for answer.  I had a load of problems with the example from VOIP-info where it passes in the extension number, which is &#8220;s&#8221; for start.  If the SMS application sees an &#8220;s&#8221; it thinks it means &#8220;send&#8221;.  That won&#8217;t work!</p>
<p>If you manage to bodge all this in to your dial plan then you should find your incoming SMS&#8217;s in /var/spool/asterisk/sms/mtrx</p>
<p>Make sure that /var/spool/asterisk is writeable by the same user as Asterisk is running as.</p>
<p><span style="text-decoration: underline;"><strong>Sending SMS&#8217;s.</strong></span> Was a whole bunch of no fun as well.  Especially if you don&#8217;t understand Asterisk properly.</p>
<p>The command line I&#8217;m using to send an SMS is:</p>
<pre class="codestyle">smsq --motx-channel=Zap/2/17094009 -d &lt;phone number&gt;  -m "&lt;message&gt;"
</pre>
<p>That works because zap channel 2 is my PSTN line.  You might need to change this.  17094009 is the SMSC centre number for BT to accept SMS messages for delivery to other networks.</p>
<p>When I was trying to get sending working, which I actually did first, I couldn&#8217;t reliably get Asterisk to talk to the SMSC.  Before I had the receive working properly the BT system would ring me up and I&#8217;d answer the phone, then not hearing a carrier the BT system would hang up again.  This gave me an idea, if I could emulate the carrier then I could hear what the BT system was sending down the line.  I sent an SMS to the home phone, it rang in on one of the extensions and I whistled at it.  Because I am just so <a href="http://en.wikipedia.org/wiki/Leet">1337</a> I hit the right tone and I could hear FSK noises coming down the line, but they were really really quiet.  I tweaked the gain up a little bit in the /etc/asterisk/zapata.conf file:</p>
<pre class="codestyle">rxgain=2
txgain=0
</pre>
<p>and tried again.  It was louder!  Sending a test message to &#8220;00000&#8221; with the text of &#8220;test&#8221;  causes the BT system to send a message back to you  (you need to send &#8220;register&#8221; to 00000 before BT will send you messages as text instead of reading them to you by the way &#8211; but if it can&#8217;t successfully deliver the message back to you to say it has received your &#8220;register&#8221; message it will ignore the request and you&#8217;ll keep getting the messages read to you by a friendly robot &#8211; hence the need to get receiving working first).  It sent!  I saw some hex coming from the SMS application in the Asterisk log.  I sent a text to my mobile, and it arrived.  Yay!  problem solved.</p>
<p>5.  Asterisk&#8217;s dial plan.  Bonkers.  I still can&#8217;t make sense of them.  Oh well, I&#8217;ll get there in the end.</p>
<p>6.  FreePBX is brilliant if you want to get Asterisk configured with some very complex applications (think voicemail) in a matter of minutes.  But, if it makes editing the config files by hand a bit more complicated because you have to use xxxx_custom files.  Thus, all the replication of code when as above when you don&#8217;t understand how it all works.</p>
<p>7.  Check out my hold music hacked together from various online sources, and no doubt subject to various copyright restrictions.  I&#8217;ve compressed the hell out of it, if you want a better quality version for your own amusement let me know.</p>
<p><a href="/wp-content/uploads/2009/09/holdmusic.mp3">Hold Music</a></p>
<p>I crack myself up, I really do.</p>
<p>Also &#8211; think of all the cool things you could do if you could phone or text your computer and get it to do things for you.</p>
<p>Now I&#8217;m off to write myself an gmail &lt;-&gt; SMS gateway doodad.</p>
<p>Ok &#8211; with Asterisk 1.6 the above is slightly less relevant.  Try this in your dialplan instead:</p>
<pre>[will-sms]</pre>
<pre>exten =&gt; s,1,Verbose(=============Entered Will SMS)</pre>
<pre>exten =&gt; s,n,Answer()</pre>
<pre>exten =&gt; s,n,SMS(default,ap(1500))</pre>
<pre>exten =&gt; s,n,Verbose(=============Done with Will SMS)</pre>
<pre>exten =&gt; s,n,Hangup(16)

The SMS application has the option to add a pause which I've set to 1500 ms.  Seems to work.</pre>
        <div class="clearfix"></div>
          
       
    </section>
            <footer class="entry-footer">
                    <div class="meta">
					<span class="author">Posted by </span><a href="/author/will/" title="Posts by will" rel="author">will</a>                <span class="seporator">/</span>
                <span class="date-post h6">September 16, 2009</span>
                                                                                                                                                                                            <span class="seporator">/</span>
                        <span>Posted in</span>
                        <a href="/category/asterisk/" rel="category tag">asterisk</a><span>,</span> <a href="/category/linux/" rel="category tag">linux</a><span>,</span> <a href="/category/tv/" rel="category tag">tv</a>                                                                </div>
            </footer>
    </article><!-- #post -->                                    <article id="post-199" class="post-in-blog post post-199 type-post status-publish format-standard hentry category-linux">
                    <header class="entry-header">
        <h2 class="entry-title">
            <a href="/2009/07/14/told-you-so/" rel="bookmark">Told you so&#8230;</a>
        </h2>
    </header> 
    <section class="entry entry-content">
        <p><img loading="lazy" class="alignnone size-medium wp-image-200" title="Tim The Enchanter" src="/wp-content/uploads/2009/07/tim-300x208.jpg" alt="Tim The Enchanter" width="300" height="208"></p>
<p>I warned you, I warned you.  But would you listen?  Oh no.  You knew it all.</p>
<p>Spotify is on the ropes.</p>
<p><a href="http://stuff.tv/blogs/music/archive/2009/07/13/why-spotify-might-die.aspx">http://stuff.tv/blogs/music/archive/2009/07/13/why-spotify-might-die.aspx</a></p>
<p>Sign up to the paid for service if you can.  Now &#8211; if they had a proper native Linux client I would.</p>
        <div class="clearfix"></div>
          
       
    </section>
            <footer class="entry-footer">
                    <div class="meta">
					<span class="author">Posted by </span><a href="/author/will/" title="Posts by will" rel="author">will</a>                <span class="seporator">/</span>
                <span class="date-post h6">July 14, 2009</span>
                                                                                                                                                                                            <span class="seporator">/</span>
                        <span>Posted in</span>
                        <a href="/category/linux/" rel="category tag">linux</a>                                                                </div>
            </footer>
    </article><!-- #post -->                                                <nav class="navigation paging-navigation">
                    <a class="prev page-numbers" href="/category/linux/page/6/">&laquo; Previous</a>
<a class="page-numbers" href="/category/linux/">1</a>
<span class="page-numbers dots">&hellip;</span>
<a class="page-numbers" href="/category/linux/page/5/">5</a>
<a class="page-numbers" href="/category/linux/page/6/">6</a>
<span aria-current="page" class="page-numbers current">7</span>
<a class="page-numbers" href="/category/linux/page/8/">8</a>
<a class="next page-numbers" href="/category/linux/page/8/">Next &raquo;</a>                </nav><!-- .navigation -->

            
        </div>
        <div class=" col-xs-12 col-sm-12 col-md-4 col-lg-4">
            <aside id="sidebar">
    <div class="widget-area">
                    <div id="archives-4" class="widget widget_archive">
<h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href="/2021/07/">July 2021</a></li>
	<li><a href="/2021/01/">January 2021</a></li>
	<li><a href="/2019/07/">July 2019</a></li>
	<li><a href="/2019/06/">June 2019</a></li>
	<li><a href="/2019/05/">May 2019</a></li>
	<li><a href="/2017/05/">May 2017</a></li>
	<li><a href="/2017/03/">March 2017</a></li>
	<li><a href="/2017/02/">February 2017</a></li>
	<li><a href="/2016/12/">December 2016</a></li>
	<li><a href="/2016/11/">November 2016</a></li>
	<li><a href="/2016/10/">October 2016</a></li>
	<li><a href="/2016/09/">September 2016</a></li>
	<li><a href="/2016/02/">February 2016</a></li>
	<li><a href="/2015/12/">December 2015</a></li>
	<li><a href="/2015/10/">October 2015</a></li>
	<li><a href="/2015/09/">September 2015</a></li>
	<li><a href="/2015/06/">June 2015</a></li>
	<li><a href="/2015/05/">May 2015</a></li>
	<li><a href="/2015/02/">February 2015</a></li>
	<li><a href="/2014/08/">August 2014</a></li>
	<li><a href="/2014/02/">February 2014</a></li>
	<li><a href="/2014/01/">January 2014</a></li>
	<li><a href="/2013/12/">December 2013</a></li>
	<li><a href="/2013/11/">November 2013</a></li>
	<li><a href="/2013/02/">February 2013</a></li>
	<li><a href="/2012/11/">November 2012</a></li>
	<li><a href="/2012/08/">August 2012</a></li>
	<li><a href="/2012/03/">March 2012</a></li>
	<li><a href="/2011/09/">September 2011</a></li>
	<li><a href="/2011/08/">August 2011</a></li>
	<li><a href="/2011/07/">July 2011</a></li>
	<li><a href="/2011/06/">June 2011</a></li>
	<li><a href="/2011/04/">April 2011</a></li>
	<li><a href="/2011/02/">February 2011</a></li>
	<li><a href="/2010/10/">October 2010</a></li>
	<li><a href="/2010/09/">September 2010</a></li>
	<li><a href="/2010/08/">August 2010</a></li>
	<li><a href="/2010/06/">June 2010</a></li>
	<li><a href="/2010/01/">January 2010</a></li>
	<li><a href="/2009/10/">October 2009</a></li>
	<li><a href="/2009/09/">September 2009</a></li>
	<li><a href="/2009/08/">August 2009</a></li>
	<li><a href="/2009/07/">July 2009</a></li>
	<li><a href="/2009/06/">June 2009</a></li>
	<li><a href="/2009/05/">May 2009</a></li>
			</ul>

			</div>
		<div id="recent-posts-2" class="widget widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="/2021/07/14/finally-moving-to-a-static-site/">Finally moving to a static site</a>
									</li>
											<li>
					<a href="/2021/01/02/double-helping-of-pi-hole/">Double helping of Pi Hole</a>
									</li>
											<li>
					<a href="/2019/07/16/dns-over-https-in-a-snap/">DNS over HTTPS in a snap</a>
									</li>
											<li>
					<a href="/2019/06/11/whizzy-labs-wireless-sensor/">Whizzy Labs Wireless Sensor</a>
									</li>
											<li>
					<a href="/2019/05/07/ubuntu-developer-desktop-survey-2019/">Ubuntu Developer Desktop Survey 2019</a>
									</li>
					</ul>

		</div>
<div id="categories-4" class="widget widget_categories">
<h3 class="widget-title">Categories</h3>
			<ul>
					<li class="cat-item cat-item-2">
<a href="/category/alexa/">Alexa</a>
</li>
	<li class="cat-item cat-item-3">
<a href="/category/arduino/">Arduino</a>
</li>
	<li class="cat-item cat-item-4">
<a href="/category/asterisk/">asterisk</a>
</li>
	<li class="cat-item cat-item-5">
<a href="/category/google-maps/">Google Maps</a>
</li>
	<li class="cat-item cat-item-6">
<a href="/category/iot/">IoT</a>
</li>
	<li class="cat-item cat-item-7">
<a href="/category/javascript/">Javascript</a>
</li>
	<li class="cat-item cat-item-8 current-cat">
<a aria-current="page" href="/category/linux/">linux</a>
</li>
	<li class="cat-item cat-item-9">
<a href="/category/making-the-world-a-better-place/">Making the world a better place</a>
</li>
	<li class="cat-item cat-item-10">
<a href="/category/raspberrypi/">RaspberryPi</a>
</li>
	<li class="cat-item cat-item-12">
<a href="/category/so-called-humor/">So called humor</a>
</li>
	<li class="cat-item cat-item-13">
<a href="/category/tv/">tv</a>
</li>
	<li class="cat-item cat-item-14">
<a href="/category/ubuntu-2/">Ubuntu</a>
</li>
	<li class="cat-item cat-item-15">
<a href="/category/uncategorized/">Uncategorized</a>
</li>
			</ul>

			</div>            </div>
<!-- .widget-area -->
</aside>
        </div>
    </div>
</div>

</div>
<!-- #main -->
	<footer id="footer" class="site-footer">
		<a href="#" id="toTop" class="toTop"><i class="fa fa-angle-up"></i></a>
		<div class="footer-sidebar">
    <div class="container">
        <div class="row">            
                        <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
                            </div>
            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
                            </div>
            <div class="col-xs-12 col-sm-12 col-md-4 col-lg-4">
                            </div>
        </div>
<!-- .widget-area -->
    </div>
</div>		<div class="footer-inner">
			<div class="container">
								<p class="social-profile type1 pull-right">
																<a href="https://twitter.com/8none1" class="button-twitter" title="Twitter" target="_blank"><i class="fa fa-twitter-square"></i></a>
																					<a href="https://github.com/8none1" class="button-google" title="Google +" target="_blank"><i class="fa fa-google-plus-square"></i></a>
																															<a href="https://www.youtube.com/user/willcooke1" class="button-youtube" title="Youtube" target="_blank"><i class="fa fa-youtube-square"></i></a>
															                    
				</p>
				<p class="copyright"><span class="copyright-date">
						&copy; Copyright 2021                    </span>
										  <a href="/" title="whizzy.org" target="_blank">whizzy.org</a>
					  &#8226; Designed by <a href="https://motopress.com/" rel="nofollow" title="Premium WordPress Plugins and Themes">MotoPress</a>
					  &#8226; Proudly Powered by <a href="http://wordpress.org/" rel="nofollow" title="Semantic Personal Publishing Platform">WordPress</a>
					  				</p>
<!-- .copyright -->
			</div>
		</div>
	</footer>
</div>
<script type="text/javascript" src="/wp-includes/js/hoverIntent.min.js" td="hoverIntent-js"></script>
<script type="text/javascript" src="/wp-content/themes/emmet-lite/js/superfish.min.js" td="superfish.min-js"></script>
<script type="text/javascript" src="/wp-content/themes/emmet-lite/js/jquery.flexslider-min.js" td="flexslider-js"></script>
<script type="text/javascript" src="/wp-content/themes/emmet-lite/js/jquery.appear.min.js" td="jquery.appear-js"></script>
<script type="text/javascript" id="emmet-script-js-extra">
/* <![CDATA[ */
var screenReaderText = {"expand":"expand child menu","collapse":"collapse child menu"};
var template_directory_uri = {"url":"\/wp-content\/themes\/emmet-lite"};
/* ]]> */
</script>
<script type="text/javascript" src="/wp-content/themes/emmet-lite/js/emmet.min.js" td="emmet-script-js"></script>
<script type="text/javascript" src="/wp-includes/js/wp-embed.min.js" td="wp-embed-js"></script>
    <script>
        /(trident|msie)/i.test(navigator.userAgent)&&document.getElementById&&window.addEventListener&&window.addEventListener("hashchange",function(){var t,e=location.hash.substring(1);/^[A-z0-9_-]+$/.test(e)&&(t=document.getElementById(e))&&(/^(?:a|select|input|button|textarea)$/i.test(t.tagName)||(t.tabIndex=-1),t.focus())},!1);
    </script>
	</body>
</html>